<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Museum Planning (Buffet & Zelfservice)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #d35400;
            --light: #ecf0f1;
            --success: #27ae60;
            --money: #16a085;
            --closed: #bdc3c7;
        }

        body {
            font-family: 'Roboto', sans-serif;
            font-size: 19px;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1, h2, h3 { font-weight: 700; }

        .container { max-width: 1200px; margin: 0 auto; }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9em;
            color: #555;
        }

        select, input[type="number"], input[type="checkbox"] {
            padding: 15px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        .toggle-blockbuster {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 25px;
        }

        .day-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            cursor: pointer;
            border-left: 8px solid var(--money);
        }

        .day-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        .day-card.closed {
            background-color: #e0e0e0;
            border-left-color: var(--closed);
            opacity: 0.6;
            cursor: not-allowed;
        }

        .day-card.blockbuster-active {
            border-left-color: var(--accent);
            background: #fffbf5;
        }

        .date-header {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .prediction-box {
            background: #e8f8f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .revenue-count {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--money);
        }

        .visitor-estimate {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .staff-advice {
            background: #fafafa;
            padding: 15px;
            border-radius: 8px;
        }

        .staff-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95em;
            border-bottom: 1px dashed #eee;
            padding-bottom: 4px;
        }

        .staff-count { font-weight: 700; color: var(--success); }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 650px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-btn { float: right; font-size: 2em; cursor: pointer; color: #999; }
        
        .factor-list { list-style: none; padding: 0; margin: 20px 0; }
        .factor-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
        .positive-factor { color: var(--success); font-weight: bold; }
        .negative-factor { color: #c0392b; font-weight: bold; }

        .btn {
            background-color: var(--money);
            color: white;
            border: none;
            padding: 18px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            font-weight: bold;
        }
        
        .history-input {
            margin-top: 30px;
            padding: 25px;
            background: #fff3cd;
            border-radius: 8px;
            border: 1px solid #ffeeba;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ’¶ Omzet & Planning Tool</h1>
    
    <div class="controls">
        <div class="control-group">
            <label>Gem. Dagomzet (Basislijn)</label>
            <input type="number" id="base-revenue" value="7500" onchange="renderCalendar()">
        </div>

        <div class="control-group">
            <label>Gem. besteding p.p. (â‚¬)</label>
            <input type="number" id="avg-spend" value="18.50" step="0.50" onchange="renderCalendar()">
            <small style="color:#777">Entree + Buffet + Shop</small>
        </div>

        <div class="toggle-blockbuster">
            <input type="checkbox" id="blockbuster-toggle" onchange="renderCalendar()" style="width: 30px; height: 30px;">
            <div>
                <strong>Blockbuster?</strong><br>
                <span>Verwachting: x 2.5 omzet</span>
            </div>
        </div>
    </div>

    <div class="calendar-grid" id="calendar-grid"></div>
</div>

<div id="detail-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 id="modal-date-title">FinanciÃ«le Analyse</h2>
        
        <div id="modal-explanation"></div>

        <div class="history-input">
            <h3>ðŸ“ˆ Train het Model</h3>
            <p>Wat was de <strong>werkelijke omzet</strong> op deze dag?</p>
            <label>Werkelijke omzet (â‚¬):</label>
            <input type="number" id="actual-revenue-input" placeholder="Bijv. 8200">
            <button class="btn" onclick="updateModel()">Update Verwachting</button>
        </div>
    </div>
</div>

<script>
    // --- SETTINGS ---
    const FACTORS = {
        weekday: 1.0,
        weekend: 1.7,       
        holiday: 1.5,       
        blockbuster: 2.5,   
        rainy: 1.25,        // Museumweer = druk
        sunny: 0.80         // Strandweer = rustig (concurrentie van buiten)
    };

    // AANGEPASTE PERSONEELSRATIO'S
    // Buffet/Zelfservice is efficiÃ«nter dan bediening.
    const STAFFING_RATIOS = {
        kassa: 150,      
        beveiliging: 300,
        buffet: 200,     // AANGEPAST: 1 pers per 200 bezoekers (aanvullen/kassa)
        schoonmaak: 500  
    };

    const MOCK_DATA = {
        holidays: [16, 17, 18, 19, 20, 21, 22],
        rainyDays: [3, 4, 12, 18],
        sunnyDays: [10, 11, 25]
    };

    let currentBaseRevenue = 7500;
    let avgSpend = 18.50;

    renderCalendar();

    function renderCalendar() {
        const grid = document.getElementById('calendar-grid');
        grid.innerHTML = '';
        
        const isBlockbuster = document.getElementById('blockbuster-toggle').checked;
        currentBaseRevenue = parseFloat(document.getElementById('base-revenue').value);
        avgSpend = parseFloat(document.getElementById('avg-spend').value);

        for (let i = 1; i <= 28; i++) {
            const date = new Date(2026, 1, i); 
            const dayOfWeek = date.getDay(); 

            if (dayOfWeek === 1) {
                grid.innerHTML += createClosedCard(i);
                continue;
            }

            const predictionData = calculateRevenue(i, dayOfWeek, isBlockbuster);
            const estimatedVisitors = Math.round(predictionData.revenue / avgSpend);
            const staffNeeded = calculateStaff(estimatedVisitors);

            grid.innerHTML += createDayCard(i, date, predictionData, estimatedVisitors, staffNeeded, isBlockbuster);
        }
    }

    function calculateRevenue(day, dayOfWeek, isBlockbuster) {
        let factors = [];
        let multiplier = 1.0;

        if (dayOfWeek === 0 || dayOfWeek === 6) {
            multiplier *= FACTORS.weekend;
            factors.push({ name: "Weekend", val: "+70%", type: "pos" });
        }

        if (MOCK_DATA.holidays.includes(day)) {
            multiplier *= FACTORS.holiday;
            factors.push({ name: "Vakantieperiode", val: "+50%", type: "pos" });
        }

        if (MOCK_DATA.rainyDays.includes(day)) {
            multiplier *= FACTORS.rainy;
            factors.push({ name: "Regen (Museumweer)", val: "+25%", type: "pos" });
        } else if (MOCK_DATA.sunnyDays.includes(day)) {
            multiplier *= FACTORS.sunny;
            factors.push({ name: "Zonnig (Strandweer - Rustig)", val: "-20%", type: "neg" });
        }

        if (isBlockbuster) {
            multiplier *= FACTORS.blockbuster;
            factors.push({ name: "Blockbuster Tentoonstelling", val: "+150%", type: "pos" });
        }

        const revenue = Math.round(currentBaseRevenue * multiplier);
        return { revenue, factors, multiplier };
    }

    function calculateStaff(visitors) {
        return {
            kassa: Math.ceil(visitors / STAFFING_RATIOS.kassa),
            beveiliging: Math.max(2, Math.ceil(visitors / STAFFING_RATIOS.beveiliging)),
            buffet: Math.ceil(visitors / STAFFING_RATIOS.buffet), // Nieuwe berekening
            schoonmaak: Math.ceil(visitors / STAFFING_RATIOS.schoonmaak)
        };
    }

    function createClosedCard(day) {
        return `
            <div class="day-card closed">
                <div class="date-header">
                    <span>${day} Feb</span>
                    <span>Maandag</span>
                </div>
                <div style="text-align:center; padding: 20px;"><h3>GESLOTEN</h3></div>
            </div>
        `;
    }

    function createDayCard(day, date, data, visitors, staff, isBlockbuster) {
        const dayName = date.toLocaleDateString('nl-NL', { weekday: 'long' });
        const bbClass = isBlockbuster ? 'blockbuster-active' : '';
        const safeData = JSON.stringify(data).replace(/"/g, '&quot;');
        const safeStaff = JSON.stringify(staff).replace(/"/g, '&quot;');
        const fmtEuro = new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(data.revenue);

        return `
            <div class="day-card ${bbClass}" onclick="openModal(${day}, '${dayName}', ${safeData}, ${visitors}, ${safeStaff})">
                <div class="date-header">
                    <span>${day} Feb</span>
                    <span>${dayName}</span>
                </div>
                
                <div class="prediction-box">
                    <div style="font-size: 0.8em; text-transform:uppercase; letter-spacing:1px; margin-bottom:5px;">Verwachte Omzet</div>
                    <div class="revenue-count">${fmtEuro}</div>
                    <div class="visitor-estimate">Geschat: Â±${visitors} bezoekers</div>
                </div>

                <div class="staff-advice">
                    <strong>ðŸ‘· Rooster Advies:</strong>
                    <div class="staff-row"><span>Kassa:</span> <span class="staff-count">${staff.kassa}</span></div>
                    <div class="staff-row"><span>Beveiliging:</span> <span class="staff-count">${staff.beveiliging}</span></div>
                    <div class="staff-row"><span>Buffet/Zelfservice:</span> <span class="staff-count">${staff.buffet}</span></div>
                </div>
            </div>
        `;
    }

    function openModal(day, dayName, data, visitors, staff) {
        document.getElementById('detail-modal').style.display = 'flex';
        document.getElementById('modal-date-title').innerText = `Analyse ${dayName} ${day} Feb`;
        
        const fmtEuro = new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR' }).format(data.revenue);
        const fmtBase = new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR' }).format(currentBaseRevenue);

        let html = `
            <h3>ðŸ’° Omzetverwachting: ${fmtEuro}</h3>
            <p>Geschat op basis van een dag-basislijn van <strong>${fmtBase}</strong>.</p>
            
            <h4>Invloedsfactoren:</h4>
            <ul class="factor-list">
        `;

        if (data.factors.length === 0) {
            html += `<li class="factor-item"><span>Geen bijzonderheden</span><span>Normaal</span></li>`;
        } else {
            data.factors.forEach(f => {
                const colorClass = f.type === 'pos' ? 'positive-factor' : 'negative-factor';
                html += `<li class="factor-item"><span>${f.name}</span><span class="${colorClass}">${f.val}</span></li>`;
            });
        }
        
        html += `</ul>`;
        
        html += `<h4>ðŸ‘¥ Personeel (o.b.v. Â±${visitors} bezoekers)</h4>`;
        html += `<p>Omdat we rekenen met een gemiddelde besteding van <strong>â‚¬${avgSpend}</strong> p.p. (ticket + buffet), vertaalt de omzet zich in het volgende rooster:</p>`;
        html += `<ul>
            <li><strong>Kassa (${staff.kassa}):</strong> Ticketverkoop & info.</li>
            <li><strong>Buffet/Zelfservice (${staff.buffet}):</strong> Aanvullen buffet, kassa buffet en afruimen. (EfficiÃ«nte bezetting door zelfservice).</li>
            <li><strong>Beveiliging (${staff.beveiliging}):</strong> Veiligheidsnorm.</li>
        </ul>`;

        document.getElementById('modal-explanation').innerHTML = html;
    }

    function closeModal() {
        document.getElementById('detail-modal').style.display = 'none';
    }

    function updateModel() {
        const actualRevenue = parseFloat(document.getElementById('actual-revenue-input').value);
        if (!actualRevenue) return alert("Vul een bedrag in.");

        const diff = actualRevenue - currentBaseRevenue;
        const learningRate = 0.15; 
        const newBase = Math.round(currentBaseRevenue + (diff * learningRate));
        
        alert(`Gegevens verwerkt!\n\nDe omzet was â‚¬${actualRevenue}.\nHet algoritme past de basislijn aan naar â‚¬${newBase} voor toekomstige voorspellingen.`);
        
        document.getElementById('base-revenue').value = newBase;
        renderCalendar();
        closeModal();
    }
    
    window.onclick = function(event) {
        if (event.target == document.getElementById('detail-modal')) closeModal();
    }
</script>

</body>
</html>
